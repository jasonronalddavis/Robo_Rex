[platformio]
; Select which USB path you are using by default.
; - freenove_esp32_s3_otg  : native USB-CDC via OTG port (requires ARDUINO_USB_* flags)
; - freenove_esp32_s3_uart : external CH34x USB-UART bridge (no ARDUINO_USB_* flags)
; macOS port names: OTG → /dev/cu.usbmodem* | CH34x → /dev/cu.wchusbserial*
; If your upload log shows `/dev/cu.wchusbserial*`, set the default to the UART env below.
default_envs = freenove_esp32_s3_uart

; Common settings shared by both USB paths
[env]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
upload_protocol = esptool
upload_speed = 460800
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
board_upload.use_1200bps_touch = no
board_build.flash_mode = dio
board_build.f_flash    = 80000000L

; Library set used by both environments
lib_deps =
  ; JSON parsing (if needed)
  bblanchon/ArduinoJson@^6.21.3

  ; ESP32 Servo Library for direct GPIO control (channels 0-5)
  madhephaestus/ESP32Servo@^3.0.5

  ; PCA9685 PWM Servo Driver for leg servos (channels 6-15)
  adafruit/Adafruit PWM Servo Driver Library@^3.0.1

  ; IMU sensor (optional)
  adafruit/Adafruit MPU6050@^2.2.5
  adafruit/Adafruit BusIO@^1.15.0

  ; Sensor fusion (optional)
  https://github.com/arduino-libraries/MadgwickAHRS.git

  ; Base64 encoding (if needed)
  https://github.com/Xander-Electronics/Base64.git

; --- Environment: OTG / native USB-CDC port ---
; Use this when you plug into the ESP32-S3 OTG port (device usually shows up as /dev/tty.usbmodem* on macOS).
[env:freenove_esp32_s3_otg]
build_flags =
  -DARDUINO_USB_CDC_ON_BOOT=1
  -DARDUINO_USB_MODE=1
  -DIMU_SENSOR_MPU6050
  -DIMU_SDA_PIN=8
  -DIMU_SCL_PIN=9
  ; -DIMU_DEBUG
  -DPCA9685_SDA_PIN=4
  -DPCA9685_SCL_PIN=5

; --- Environment: UART / CH34x bridge ---
; Use this when you plug into the CH343/CH340 USB-UART port (device usually shows up as /dev/tty.wchusbserial* on macOS).
; IMPORTANT: No ARDUINO_USB_* flags here, this uses the classic UART0 path.
[env:freenove_esp32_s3_uart]
build_flags =
  -DIMU_SENSOR_MPU6050
  -DIMU_SDA_PIN=8
  -DIMU_SCL_PIN=9
  ; -DIMU_DEBUG
  -DPCA9685_SDA_PIN=4
  -DPCA9685_SCL_PIN=5
